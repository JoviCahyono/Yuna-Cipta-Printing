<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Yuna Cipta Printing App</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="logo-container">
          <img
            alt="Company Logo"
            height="50"
            src="images/download.png"
            width="50"
          />
          <div class="company-name">
            <h2>Yuna Cipta</h2>
            <h2>Printing</h2>
          </div>
        </div>
        <ul>
          <li>
            <a class="active" href="./dashboard.html">
              <i class="fas fa-home"></i>Dashboard
            </a>
          </li>
          <li>
            <a href="./index.html">
              <i class="fas fa-file-invoice-dollar"></i>Penggajian
            </a>
          </li>
          <li>
            <a href="./karyawan.html"> <i class="fas fa-users"></i>Karyawan </a>
          </li>
          <li>
            <a href="#"> <i class="fas fa-warehouse"></i>Gudang </a>
          </li>
          <li>
            <a href="#"> <i class="fas fa-sign-out-alt"></i>Keluar </a>
          </li>
        </ul>
      </div>

      <!-- Konten Dashboard -->
      <div class="content">
        <div class="header">
          <h1>Dashboard</h1>
          <div class="user-info">
            <img
              alt="User Avatar"
              height="40"
              src="https://storage.googleapis.com/a1aa/image/GeLjokFSmRzWOiheT5ltybYeWnby2fP58auwTEXmkMuMkftfE.jpg"
              width="40"
            />
            <div>
              <span> Admin </span>
              <br />
              <span class="role"> Admin </span>
            </div>
          </div>
        </div>

        <!-- Ringkasan Data -->
        <div class="summary">
          <div class="card">
            <h3>Jumlah Karyawan</h3>
            <p id="jumlah-karyawan">0</p>
          </div>
          <div class="card">
            <h3>Total Gaji</h3>
            <p id="total-gaji">0</p>
          </div>
          <div class="card">
            <h3>Total Kasbon</h3>
            <p id="total-kasbon">0</p>
          </div>
        </div>

        <!-- Grafik -->
        <div class="charts">
          <div class="chart-container">
            <h2>Total Gaji Perbulan</h2>
            <canvas id="gajiChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="renderer.js"></script>
    <script>
      // Parse the JSON data
      // Fungsi untuk memformat angka dengan pemisah ribuan
      function formatNumber(num) {
        return new Intl.NumberFormat("id-ID").format(num);
      }

      // Memuat data dari file data.json
      fetch("./data.json")
        .then((response) => response.json())
        .then((data) => {
          // Hitung jumlah karyawan
          const jumlahKaryawan = data.karyawan.length;
          document.getElementById("jumlah-karyawan").textContent =
            formatNumber(jumlahKaryawan);

          // Hitung total gaji
          const totalGaji = data.penggajian.reduce(
            (total, item) => total + (item.gaji || 0),
            0
          );
          document.getElementById("total-gaji").textContent =
            "Rp " + formatNumber(totalGaji);

          // Hitung total kasbon
          const totalKasbon = data.karyawan.reduce(
            (total, item) => total + (item.kasbon || 0),
            0
          );
          document.getElementById("total-kasbon").textContent =
            "Rp " + formatNumber(totalKasbon);
        })
        .catch((error) => {
          console.error("Error:", error);
        });


        
      // Fungsi untuk memformat angka dengan pemisah ribuan
      function formatNumber(num) {
        return new Intl.NumberFormat("id-ID").format(num);
      }

      // Memuat data dari file data.json
      fetch("./data.json")
        .then((response) => response.json())
        .then((data) => {
          // Proses data penggajian untuk menghitung total gaji per bulan
          const gajiPerBulan = {};

          data.penggajian.forEach((entry) => {
            const month = new Date(entry.tanggal_gajian).toLocaleString("default", { month: "long", year: "numeric" });
            if (!gajiPerBulan[month]) {
              gajiPerBulan[month] = 0;
            }
            gajiPerBulan[month] += entry.gaji;
          });

          // Persiapkan data untuk chart
          const labels = Object.keys(gajiPerBulan);
          const gajiData = Object.values(gajiPerBulan);

          // Tampilkan grafik dengan Chart.js
          const ctx = document.getElementById("gajiChart").getContext("2d");
          new Chart(ctx, {
            type: "bar", // Jenis grafik (Bar chart)
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Total Gaji Per Bulan (Rp)",
                  data: gajiData,
                  backgroundColor: "#312F8D", // Warna ungu tua
                  borderColor: "#312F8D", // Warna ungu tua
                  borderWidth: 1
                }
              ]
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return "Rp " + formatNumber(value); // Format Y axis sebagai mata uang
                    }
                  }
                }
              }
            }
          });
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    </script>
  </body>
</html>
